<form class="{{cssClass}}" autocomplete="off">

    {{!-- Sheet Header --}}
    <header class="sheet-header">
        <div class="header-fields">
            <div style="display: flex">
                <img class="profile-img" src="{{item.img}}" data-edit="img" title="{{item.name}}"/>
                <h1 class="charname"><input name="name" type="text" value="{{item.name}}" placeholder="Name"/></h1>
            </div>
            <table style="margin: unset; padding: unset; background: unset; border: unset;">
                <tr>
                    <td style="width: 50%; vertical-align:top"><!-- Left Col -->
                        <table style="background: #00ffff47">
                            <tr>
                                <th colspan="2" style="font-size: larger">Ritual Details</th>
                            </tr>
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Ritual Type:</label>
                                </td>
                                <td>
                                    <select name="system.ritualType">
                                        {{#select item.system.ritualType}}
                                        <option value="standard">Standard</option>
                                        <option value="conditional">Conditional</option>
                                        <option value="charm">Charm</option>
                                        <option value="elixir">Elixir</option>
                                        <option value="conditionalCharm">Conditional Charm</option>
                                        {{/select}}
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Ritual Mastery:</label>
                                </td>
                                <td>
                                    <input id="rpmStats" type="checkbox" name="system.ritualMastery" {{checked item.system.ritualMastery}} data-dtype="Boolean"/>
                                </td>
                            </tr>
                            {{#if item.system.higherPurpose1Present}}
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Higher Purpose ({{item.system.higherPurpose1Name}}) applies for a +{{item.system.higherPurpose1Level}} bonus</label>
                                </td>
                                <td>
                                    <input id="hp1" type="checkbox" name="system.higherPurpose1Applies" {{checked item.system.higherPurpose1Applies}} data-dtype="Boolean"/>
                                </td>
                            </tr>
                            {{/if}}
                            {{#if item.system.higherPurpose2Present}}
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Higher Purpose ({{item.system.higherPurpose2Name}}) applies for a +{{item.system.higherPurpose2Level}} bonus</label>
                                </td>
                                <td>
                                    <input id="hp2" type="checkbox" name="system.higherPurpose2Applies" {{checked item.system.higherPurpose2Applies}} data-dtype="Boolean"/>
                                </td>
                            </tr>
                            {{/if}}
                            {{#if item.system.higherPurpose3Present}}
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Higher Purpose ({{item.system.higherPurpose3Name}}) applies for a +{{item.system.higherPurpose3Level}} bonus</label>
                                </td>
                                <td>
                                    <input id="hp3" type="checkbox" name="system.higherPurpose3Applies" {{checked item.system.higherPurpose3Applies}} data-dtype="Boolean"/>
                                </td>
                            </tr>
                            {{/if}}
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Grimoire Bonus</label>
                                </td>
                                <td>
                                    <input type="number" style="width: 50%" name="system.grimBonus" value="{{item.system.grimBonus}}" data-dtype="Number" />
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Level</label>
                                </td>
                                <td>
                                    {{item.system.level}}
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Energy Cost</label>
                                </td>
                                <td>
                                    {{item.system.energyCost}}
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Number Ready</label>
                                </td>
                                <td>
                                    <input type="number" style="width: 50%" name="system.quantity" value="{{item.system.quantity}}" data-dtype="Number" />
                                </td>
                            </tr>
                        </table>
                    </td>
                    <td style="width: 50%; vertical-align:top"><!-- Right Col -->
                        {{#if (or (eq item.system.ritualType "charm") (eq item.system.ritualType "conditionalCharm") (eq item.system.ritualType "conditional"))}}
                        <table style="background: rgba(255,102,0,0.28)">
                            <tr>
                                {{#if (eq item.system.ritualType "conditional")}}
                                <th colspan="2" style="font-size: larger">Conditional Ritual Details</th>
                                {{/if}}
                                {{#if (eq item.system.ritualType "conditionalCharm")}}
                                <th colspan="2" style="font-size: larger">Conditional Charm Details</th>
                                {{/if}}
                                {{#if (eq item.system.ritualType "charm")}}
                                <th colspan="2" style="font-size: larger">Charm Details</th>
                                {{/if}}
                            </tr>
                            {{#unless (eq item.system.ritualType "conditional")}}
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Workspace Modifier: </label>
                                    <input type="number" style="width: 50%" name="system.workspaceMod" value="{{item.system.workspaceMod}}" data-dtype="Number" />
                                </td>
                            </tr>
                            {{/unless}}
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Safe Threshold: </label>
                                    {{item.system.safeThreshold}}
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Character's Mana Contribution: </label>
                                    {{item.system.actorContribution}}
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Additional Sources Of Mana: </label>
                                    <input type="number" style="width: 50%" name="system.additionalSourcesOfMana" value="{{item.system.additionalSourcesOfMana}}" data-dtype="Number" />
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Total Safe Threshold: </label>
                                    {{item.system.totalSafeThreshold}}
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Crafting Roll Modifier (Higher numbers are bad): </label>
                                    {{item.system.craftingRollMod}} <input type='button' class='makeCraftingRoll' id="{{item.name}}" value='Make Crafting Roll'/>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Quirk Roll Modifier (Higher numbers are good): </label>
                                    {{item.system.quirkRollMod}} <input type='button' class='makeQuirkRoll' id="{{item.name}}"  value='Make Quirk Roll'/>
                                </td>
                            </tr>
                            {{#unless (eq item.system.ritualType "conditional")}}
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Charm Availability</label>
                                    <select name="system.charm.availability">
                                        {{#select item.system.charm.availability}}
                                        <option value="0.5">Common (Wards, healing, lucky charms)</option>
                                        <option value="1">Uncommon</option>
                                        <option value="2">Rare (Strange, overly specific)</option>
                                        <option value="2.0">Custom Order</option>
                                        {{/select}}
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Sale / Purchase Cost:</label>
                                    {{item.system.charm.saleCost}} $
                                </td>
                            </tr>
                            {{/unless}}
                        </table>
                        {{/if}}

                        {{#if (eq item.system.ritualType "elixir") }}
                        <table style="background: rgba(0,255,21,0.28)">
                            <tr>
                                <th colspan="2" style="font-size: larger">Elixir Details</th>
                            </tr>
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Workspace Modifier</label>
                                    <input type="number" style="width: 50%" name="system.workspaceMod" value="{{item.system.workspaceMod}}" data-dtype="Number" />
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Elixir Type</label>
                                    <select name="system.elixir.type">
                                        {{#select item.system.elixir.type}}
                                        <option value="grenade">Grenade</option>
                                        <option value="ointment">Ointment</option>
                                        <option value="pastille">Pastille</option>
                                        <option value="potion">Potion</option>
                                        <option value="powder">Powder</option>
                                        {{/select}}
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Safe Threshold: </label>
                                    {{item.system.safeThreshold}}
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Character's Mana Contribution: </label>
                                    {{item.system.actorContribution}}
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Additional Sources Of Mana: </label>
                                    <input type="number" style="width: 50%" name="system.additionalSourcesOfMana" value="{{item.system.additionalSourcesOfMana}}" data-dtype="Number" />
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Total Safe Threshold: </label>
                                    {{item.system.totalSafeThreshold}}
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Crafting Roll Modifier (Higher numbers are bad): </label>
                                    {{item.system.craftingRollMod}} <input type='button' class='makeCraftingRoll' id="{{item.name}}" value='Make Crafting Roll'/>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Quirk Roll Modifier (Higher numbers are good): </label>
                                    {{item.system.quirkRollMod}} <input type='button' class='makeQuirkRoll' id="{{item.name}}"  value='Make Quirk Roll'/>
                                </td>
                            </tr>
                        </table>
                        <table style="background: rgba(0,255,21,0.28)">
                            <tr>
                                <th colspan="4" style="font-size: larger; text-decoration: underline;">Alchemy Ingredients</th>
                            </tr>
                            <tr>
                                <th style="width: 66px;">Rarity</th>
                                <th>Quantity</th>
                                <th>Cost</th>
                                <th>Weight</th>
                            </tr>
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Improvised</label>
                                </td>
                                <td>
                                    <input type="number" style="width: 100%" name="system.elixir.ingredientQtys.improvised" value="{{item.system.elixir.ingredientQtys.improvised}}" data-dtype="Number" />
                                </td>
                                <td style="text-align: center">
                                    {{item.system.elixir.ingredientQtys.improvised$}} $
                                </td>
                                <td style="text-align: center">
                                    {{item.system.elixir.ingredientQtys.improvisedLb}} lbs
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Basic</label>
                                </td>
                                <td>
                                    <input type="number" style="width: 100%" name="system.elixir.ingredientQtys.basic" value="{{item.system.elixir.ingredientQtys.basic}}" data-dtype="Number" />
                                </td>
                                <td style="text-align: center">
                                    {{item.system.elixir.ingredientQtys.basic$}} $
                                </td>
                                <td style="text-align: center">
                                    {{item.system.elixir.ingredientQtys.basicLb}} lbs
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Good</label>
                                </td>
                                <td>
                                    <input type="number" style="width: 100%" name="system.elixir.ingredientQtys.good" value="{{item.system.elixir.ingredientQtys.good}}" data-dtype="Number" />
                                </td>
                                <td style="text-align: center">
                                    {{item.system.elixir.ingredientQtys.good$}} $
                                </td>
                                <td style="text-align: center">
                                    {{item.system.elixir.ingredientQtys.goodLb}} lbs
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Fine</label>
                                </td>
                                <td>
                                    <input type="number" style="width: 100%" name="system.elixir.ingredientQtys.fine" value="{{item.system.elixir.ingredientQtys.fine}}" data-dtype="Number" />
                                </td>
                                <td style="text-align: center">
                                    {{item.system.elixir.ingredientQtys.fine$}} $
                                </td>
                                <td style="text-align: center">
                                    {{item.system.elixir.ingredientQtys.fineLb}} lbs
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label class="resource-label" style="flex: 0.5;">Legendary</label>
                                </td>
                                <td style="text-align: center">
                                    <input type="number" style="width: 100%" name="system.elixir.ingredientQtys.legendary" value="{{item.system.elixir.ingredientQtys.legendary}}" data-dtype="Number" />
                                </td>
                                <td>
                                    <input type="number" style="width: 50%" name="system.elixir.ingredientQtys.legendary$" value="{{item.system.elixir.ingredientQtys.legendary$}}" data-dtype="Number" />
                                    $ each
                                </td>
                                <td>
                                    <input type="number" style="width: 50%" name="system.elixir.ingredientQtys.legendaryLb" value="{{item.system.elixir.ingredientQtys.legendaryLb}}" data-dtype="Number" />
                                    lbs each
                                </td>
                            </tr>
                            <tr>
                                <th>
                                    <label class="resource-label" style="flex: 0.5;">Total</label>
                                </th>
                                <th>
                                    {{item.system.elixir.ingredientQtys.total}}
                                </th>
                                <th>
                                    {{item.system.elixir.ingredientQtys.total$}} $
                                </th>
                                <th>
                                    {{item.system.elixir.ingredientQtys.totalLb}} lbs
                                </th>
                            </tr>
                            <tr>
                                <td colspan="2" style="text-align: right">
                                    <label class="resource-label" style="flex: 0.5;">Total Discount:</label>
                                </td>
                                <td style="text-align: center">
                                    {{item.system.elixir.discount}} %
                                </td>
                                <td style="text-align: center">
                                    {{item.system.elixir.discountManaValue}} energy
                                </td>
                            </tr>
                        </table>
                        {{/if}}
                    </td>
                </tr>
            </table>

            <div style="padding-top: 2px;">
                <label class="resource-label" style="width: 32px;">Short Notes:</label>
                <input type="text" name="system.shortNotes" value="{{item.system.shortNotes}}" style="width: calc(100% - 78px);"/>
            </div>

            <!-- Energy Gathering -->
            <table style="background: #7900ff47">
                <tr>
                    <th colspan="4" style="font-size: larger">Energy Gathering</th>
                </tr>
                <tr>
                    <td style="text-align: right; padding-right: 1em;">
                        {{#if (eq item.system.ritualAdeptTime 0) }}
                        Minutes per attempt
                        {{/if}}
                        {{#if (eq item.system.ritualAdeptTime 1) }}
                        Seconds for first attempt, minutes per subsequent attempts
                        {{/if}}
                        {{#if (eq item.system.ritualAdeptTime 2) }}
                        Seconds per attempt
                        {{/if}}
                    </td>
                    <td>
                        <input type="number" style="width: 50%" name="system.timeUnitsPerAttempt" value="{{item.system.timeUnitsPerAttempt}}" data-dtype="Number" />
                    </td>
                    <td style="text-align: right; padding-right: 1em;">
                        Gathering Modifier
                    </td>
                    <td>
                        <input type="number" style="width: 50%" name="system.gatherMod" value="{{item.system.gatherMod}}" data-dtype="Number" />
                    </td>
                </tr>
                <tr>
                    <td style="text-align: right; padding-right: 1em;">
                        Use personal mana reserve
                    </td>
                    <td>
                        <input id="usePersonalMana" type="checkbox" name="system.usePersonalMana" {{checked item.system.usePersonalMana}} data-dtype="Boolean"/>
                    </td>
                    <td style="text-align: right; padding-right: 1em;">
                        Extra mana from other sources
                    </td>
                    <td>
                        <input type="number" style="width: 50%" name="system.extraMana" value="{{item.system.extraMana}}" data-dtype="Number" />
                    </td>
                    </tr>
                <tr>
                    <td colspan="4">
                        <input type='button' class='gatherEnergy' id="{{item.name}}" value='Gather Energy' style="width: 100%; height: 30px; font-weight: bold;"/>
                    </td>
                </tr>
            </table>

            <!-- Paths -->
            <table style="background: #ed143d47;">
                <tr>
                    <th colspan="7" style="font-size: larger">Path Details</th>
                </tr>
                <tr>
                    <td style="width: 70px;">Level</td>
                    <td style="width: 90px;">Effect</td>
                    <td style="width: 95px;">Path</td>
                    <td style="width: 35px; text-align: center">Cost</td>
                    <td style="width: 37px; text-align: center">Skill</td>
                    <td>Notes</td>
                    <td style="width: 65px;"><h3 class="addPathRow" style="text-align: right;">Add Path</h3></td>
                </tr>
                {{#each item.system.path as |path id|}}
                <tr>
                    <td>
                        <select name="system.path.{{id}}.level">
                        {{#select path.level}}
                        <option value="lesser">Lesser</option>
                        <option value="greater">Greater</option>
                        {{/select}}
                        </select>
                    </td>
                    <td>
                        <select name="system.path.{{id}}.effect">
                            {{#select path.effect}}
                            <option value="sense">Sense</option>
                            <option value="strengthen">Strengthen</option>
                            <option value="restore">Restore</option>
                            <option value="control">Control</option>
                            <option value="destroy">Destroy</option>
                            <option value="create">Create</option>
                            <option value="transform">Transform</option>
                            {{/select}}
                        </select>
                    </td>
                    <td>
                        <select name="system.path.{{id}}.path">
                            {{#select path.path}}
                            <option value="body">Body</option>
                            <option value="chance">Chance</option>
                            <option value="crossroads">Crossroads</option>
                            <option value="energy">Energy</option>
                            <option value="magic">Magic</option>
                            <option value="matter">Matter</option>
                            <option value="mind">Mind</option>
                            <option value="spirit">Spirit</option>
                            <option value="undead">Undead</option>
                            {{/select}}
                        </select>
                    </td>
                    <td style="text-align: center">{{path.cost}}</td>
                    <td style="text-align: center">{{path.skill}}</td>
                    <td>
                        <input type="text" placeholder="Notes" name="system.path.{{id}}.notes" value="{{path.notes}}" title="{{path.notes}}" style="text-align:left; margin: unset" data-dtype="String"/>
                    </td>
                    <td  style="text-align: right;"><a class="path-delete" id="pathhh{{id}}" title="Delete Item"><i class="fas fa-trash"></i></a></td>
                </tr>
                {{/each}}
            </table>

            <!-- Ritual Modifiers -->
            <table style="background: rgba(190,237,20,0.28);">
                <tr>
                    <th colspan="5" style="font-size: larger">Modifier Details</th>
                </tr>
                <tr>
                    <td style="width: 143px;">Modifier</td>
                    <td>Effect</td>
                    <td style="width: 35px; text-align: center">Cost</td>
                    <td>Notes</td>
                    <td style="width: 130px;"><h3 class="addRitualModifierRow" style="text-align: right;">Add Ritual Modifier</h3></td>
                </tr>
                {{#each item.system.ritualModifier as |ritualModifier id|}}
                <tr>
                    <td>
                        <select name="system.ritualModifier.{{id}}.modifier">
                            {{#select ritualModifier.modifier}}
                            <option value="affliction">Affliction</option>
                            <option value="trait">Altered Trait</option>
                            <option value="aoe">Area Of Effect</option>
                            <option value="modifier">Bestows a Bonus or Penalty</option>
                            <option value="damage">Damage</option>
                            <option value="duration">Duration</option>
                            <option value="energy">Extra Energy</option>
                            <option value="healing">Healing</option>
                            <option value="meta">Meta-Magic</option>
                            <option value="range">Range</option>
                            <option value="speed">Speed</option>
                            <option value="weight">Subject Weight</option>
                            <option value="trappings">Traditional Trappings</option>
                            <option value="crafting">Crafting - Automatic Penalty</option>
                            <option value="gmCrafting">Crafting - GM Penalty</option>
                            {{/select}}
                        </select>
                    </td>
                    <td>
                        {{#if (eq ritualModifier.modifier "affliction") }}
                        <input type="number" name="system.ritualModifier.{{id}}.effect.percentage" value="{{ritualModifier.effect.percentage}}" style="text-align:center; width: 90%; margin: unset" min="0" step="5"/>
                        {{/if}}

                        {{#if (eq ritualModifier.modifier "trait") }}
                        <input type="number" name="system.ritualModifier.{{id}}.effect.level" value="{{ritualModifier.effect.level}}" style="text-align:center; width: 90%; margin: unset" />
                        {{/if}}

                        {{#if (eq ritualModifier.modifier "aoe") }}
                        <input type="number" name="system.ritualModifier.{{id}}.effect.area" value="{{ritualModifier.effect.area}}" style="text-align:center; width: 20%; margin-left: 10%;" /> yards
                        <input type="number" name="system.ritualModifier.{{id}}.effect.excludes" value="{{ritualModifier.effect.excludes}}" style="text-align:center; width: 20%; margin-left: 10%;" min="0"/> exclusions
                        {{/if}}

                        {{#if (eq ritualModifier.modifier "modifier") }}
                        <select name="system.ritualModifier.{{id}}.effect.scope">
                            {{#select ritualModifier.effect.scope}}
                            <option value="broad">Broad</option>
                            <option value="moderate">Moderate</option>
                            <option value="narrow">Narrow</option>
                            {{/select}}
                        </select>
                        <input type="number" name="system.ritualModifier.{{id}}.effect.modifier" value="{{ritualModifier.effect.modifier}}" style="text-align:center; width: 20%; margin-left: 10%;"/>
                        {{/if}}

                        {{#if (eq ritualModifier.modifier "damage") }}
                            <div style="height: 27px">
                                <label>Damage: </label>
                                <input type="number" name="system.ritualModifier.{{id}}.effect.dice" value="{{ritualModifier.effect.dice}}" style="text-align:center; width: 20%;"/>
                                d6 + <input type="number" name="system.ritualModifier.{{id}}.effect.adds" value="{{ritualModifier.effect.adds}}" style="text-align:center; width: 20%;"/>
                                <select name="system.ritualModifier.{{id}}.effect.woundMod">
                                    {{#select ritualModifier.effect.woundMod}}
                                    <option value="burn">burn</option>
                                    <option value="cor">cor</option>
                                    <option value="cr">cr</option>
                                    <option value="cut">cut</option>
                                    <option value="fat">fat</option>
                                    <option value="imp">imp</option>
                                    <option value="pi-">pi-</option>
                                    <option value="pi">pi</option>
                                    <option value="pi+">pi+</option>
                                    <option value="pi++">pi++</option>
                                    <option value="tox">tox</option>
                                    {{/select}}
                                </select>
                            </div>

                            <div style="height: 27px">
                                <label for="external">External</label><input id="external" type="checkbox" name="system.ritualModifier.{{id}}.effect.external" {{checked ritualModifier.effect.external}} data-dtype="Boolean"/>
                            </div>
                            {{#if ritualModifier.effect.external }}
                                <div style="height: 27px">
                                    <label for="explosive">Explosive</label><input id="explosive" type="checkbox" name="system.ritualModifier.{{id}}.effect.explosive" {{checked ritualModifier.effect.explosive}} data-dtype="Boolean"/>
                                </div>
                                <div style="height: 27px">
                                    <label for="enhancementsOn">Total Enhancements</label><input id="enhancementsOn" type="checkbox" name="system.ritualModifier.{{id}}.effect.enhancementsOn" {{checked ritualModifier.effect.enhancementsOn}} data-dtype="Boolean"/>
                                    {{#if ritualModifier.effect.enhancementsOn }}
                                        <input type="number" name="system.ritualModifier.{{id}}.effect.enhancements" value="{{ritualModifier.effect.enhancements}}" style="text-align:center; width: 10%;"/>
                                        <input type="text" name="system.ritualModifier.{{id}}.effect.enhancementNotes" value="{{ritualModifier.effect.enhancementNotes}}" style="width: 50%;" placeholder="Enhancement Notes"/>
                                    {{/if}}
                                </div>
                                <div style="height: 27px">
                                    <label for="limitationsOn">Total Limitations</label><input id="limitationsOn" type="checkbox" name="system.ritualModifier.{{id}}.effect.limitationsOn" {{checked ritualModifier.effect.limitationsOn}} data-dtype="Boolean"/>
                                    {{#if ritualModifier.effect.limitationsOn }}
                                        <input type="number" name="system.ritualModifier.{{id}}.effect.limitations" value="{{ritualModifier.effect.limitations}}" style="text-align:center; width: 10%;"/>
                                        <input type="text" name="system.ritualModifier.{{id}}.effect.limitationNotes" value="{{ritualModifier.effect.limitationNotes}}" style="width: 50%;" placeholder="Limitation Notes"/>
                                    {{/if}}
                                </div>
                            {{/if}}
                        {{/if}}

                        {{#if (eq ritualModifier.modifier "duration") }}
                        <select name="system.ritualModifier.{{id}}.effect.durationUnits">
                            {{#select ritualModifier.effect.durationUnits}}
                            <option value="minutes">Minutes</option>
                            <option value="hours">Hours</option>
                            <option value="days">Days</option>
                            <option value="weeks">Weeks</option>
                            <option value="fortnights">Fortnights</option>
                            <option value="months">Months</option>
                            <option value="years">Years</option>
                            {{/select}}
                        </select>
                        <input type="number" name="system.ritualModifier.{{id}}.effect.durationQty" value="{{ritualModifier.effect.durationQty}}" style="text-align:center; width: 20%;"/>
                        {{/if}}

                        {{#if (or (eq ritualModifier.modifier "energy") (eq ritualModifier.modifier "meta")) }}
                        <input type="number" name="system.ritualModifier.{{id}}.effect.extraEnergy" value="{{ritualModifier.effect.extraEnergy}}" style="text-align:center; width: 90%; margin: unset" />
                        {{/if}}

                        {{#if (eq ritualModifier.modifier "healing") }}
                        <div style="height: 27px">
                            <label>Healing: </label>
                            <input type="number" name="system.ritualModifier.{{id}}.effect.dice" value="{{ritualModifier.effect.dice}}" style="text-align:center; width: 20%;"/>
                            d6 + <input type="number" name="system.ritualModifier.{{id}}.effect.adds" value="{{ritualModifier.effect.adds}}" style="text-align:center; width: 20%;"/>
                            <select name="system.ritualModifier.{{id}}.effect.resource">
                                {{#select ritualModifier.effect.resource}}
                                <option value="hp">HP</option>
                                <option value="fp">FP</option>
                                {{/select}}
                            </select>
                        </div>
                        {{/if}}

                        {{#if (eq ritualModifier.modifier "range") }}
                        {{#if (or (eq ritualModifier.effect.rangeType "normal")  (eq ritualModifier.effect.rangeType "info") ) }}
                        <input type="number" name="system.ritualModifier.{{id}}.effect.range" value="{{ritualModifier.effect.range}}" style="text-align:center; width: 20%; margin-left: 10%;" /> yards
                        {{/if}}
                        {{#if (eq ritualModifier.effect.rangeType "time") }}
                        <input type="number" name="system.ritualModifier.{{id}}.effect.range" value="{{ritualModifier.effect.range}}" style="text-align:center; width: 20%; margin-left: 10%;" /> days
                        {{/if}}
                        {{#if (eq ritualModifier.effect.rangeType "dim") }}
                        <input type="number" name="system.ritualModifier.{{id}}.effect.range" value="{{ritualModifier.effect.range}}" style="text-align:center; width: 20%; margin-left: 10%;" /> dimensions crossed
                        {{/if}}
                        <select name="system.ritualModifier.{{id}}.effect.rangeType">
                            {{#select ritualModifier.effect.rangeType}}
                            <option value="normal">Normal</option>
                            <option value="info">Informational</option>
                            <option value="time">Cross-Time</option>
                            <option value="dim">Cross-Dimensional</option>
                            {{/select}}
                        </select>
                        {{/if}}

                        {{#if (eq ritualModifier.modifier "speed") }}
                        <input type="number" name="system.ritualModifier.{{id}}.effect.speed" value="{{ritualModifier.effect.speed}}" style="text-align:center; width: 20%; margin-left: 10%;" /> yards per second
                        {{/if}}

                        {{#if (eq ritualModifier.modifier "weight") }}
                        <input type="number" name="system.ritualModifier.{{id}}.effect.weight" value="{{ritualModifier.effect.weight}}" style="text-align:center; width: 50%; margin-left: 10%;" /> lbs
                        {{/if}}

                        {{#if (eq ritualModifier.modifier "trappings") }}
                        <input type="number" name="system.ritualModifier.{{id}}.effect.trappings" value="{{ritualModifier.effect.trappings}}" style="text-align:center; width: 50%; margin-left: 10%;" /> % discount
                        {{/if}}

                        {{#if (eq ritualModifier.modifier "crafting") }}
                        Item Cost: <input type="number" name="system.ritualModifier.{{id}}.effect.crafting" value="{{ritualModifier.effect.crafting}}" style="text-align:center; width: 50%;" /> $
                        <br>Crafting Penalty: {{ritualModifier.effect.craftingPenalty}}
                        {{/if}}

                        {{#if (eq ritualModifier.modifier "gmCrafting") }}
                        Modifier: <input type="number" name="system.ritualModifier.{{id}}.effect.craftingPenalty" value="{{ritualModifier.effect.craftingPenalty}}" style="text-align:center; width: 50%; margin-left: 10%;" />
                        {{/if}}

                    </td>
                    <td style="text-align: center">{{ritualModifier.cost}}</td>
                    <td><input type="text" placeholder="Notes" name="system.ritualModifier.{{id}}.notes" value="{{ritualModifier.notes}}" title="{{ritualModifier.notes}}" style="text-align:left; margin: unset" data-dtype="String"/></td>
                    <td style="text-align: right;"><a class="ritualModifier-delete" id="ritual{{id}}" title="Delete Item"><i class="fas fa-trash"></i></a></td>
                </tr>
                {{/each}}
            </table>
        </div>
    </header>


    {{!-- Sheet Tab Navigation --}}
    <nav id="tabselect" class="sheet-tabs tabs" data-group="primary">
        <div class="header">
            <a class="item" data-tab="notes">Notes</a>
        </div>
        <div class="header">
            <a class="item" data-tab="melee">Melee</a>
        </div>
        <div class="header">
            <a class="item" data-tab="ranged">Ranged</a>
        </div>
        <div class="header">
            <a class="item" data-tab="affliction">Affliction</a>
        </div>
    </nav>

    {{!-- Sheet Body --}}
    <section class="sheet-body">

        {{!-- Note Tab --}}
        <div class="tab stats" data-tab="notes" data-group="primary">
            <h3 class="bold">Detailed Notes</h3>
            <div class="tab">
                <textarea rows="8" name="system.notes">{{{item.system.notes}}}</textarea>
            </div>
        </div>

        {{!-- Melee Tab --}}
        <div class="tab stats" data-tab="melee" data-group="primary">
            <h3 class="addRow" style="text-align: right;">Add Row</h3>
            <div class="tab">
                <table>
                <tr class="equipment-header">
                    <td class="resource-label">ID</td>
                    <td class="resource-label">Name</td>
                    <td class="resource-label">Level</td>
                    <td class="resource-label">Skill Name / Mod</td>
                    <td class="resource-label">Parry - Type</td>
                    <td class="resource-label">Block</td>
                    <td class="resource-label">Damage</td>
                    <td class="resource-label">Type</td>
                    <td class="resource-label">Divisor</td>
                    <td class="resource-label">Reach</td>
                    <td class="resource-label">ST</td>
                    <td class="resource-label"></td>
                </tr>
                {{#each item.system.melee as |melee id|}}
                <tr class="equipment-entry">
                    <td class="resource-label">{{id}}</td>
                    <td><input type="text" name="system.melee.{{id}}.name" value="{{name}}" title="{{name}}" style="text-align:left;" /></td>
                    <td class="resource-label">{{melee.level}}</td>
                    <td class="equipmentInputInput">
                        <input type="text" name="system.melee.{{id}}.skill" value="{{melee.skill}}" title="{{melee.skill}}" style="text-align:left;" />/
                        <input type="text" name="system.melee.{{id}}.skillMod" value="{{melee.skillMod}}" data-dtype="Number"/>
                    </td>
                    <td>
                        <input type="text" name="system.melee.{{id}}.parryMod" value="{{melee.parryMod}}" style="width: 50%"/>
                        <input type="text" name="system.melee.{{id}}.parryType" value="{{melee.parryType}}" style="width: 20%"/>
                    </td>
                    <td>
                        <input type="text" name="system.melee.{{id}}.blockMod" value="{{melee.blockMod}}"/>
                    </td>
                    <td><input type="text" name="system.melee.{{id}}.damageInput" value="{{melee.damageInput}}" title="{{melee.damageInput}}" style="text-align:left;" /></td>
                    <td>
                        <span class="tooltip">
                            <input type="text" name="system.melee.{{id}}.damageType" value="{{melee.damageType}}" title="{{melee.damageType}}" style="text-align:left;" />
                            <span class="tooltiptext" style="margin-left: -100px">
                                <div>
                                    <span style="text-decoration: underline">Valid entries are:</span><br>
                                    burn: Burning<br>
                                    cor: Corrosion<br>
                                    cr: Crushing<br>
                                    cut: Cutting<br>
                                    fat: Fatigue<br>
                                    imp: Impaling<br>
                                    pi-: Small Piercing<br>
                                    pi: Piercing<br>
                                    pi+: Large Piercing<br>
                                    pi++: Huge Piercing<br>
                                    tox: Toxic<br>
                                    tbb: Tight Beam Burning<br>
                                    dam: Untyped<br>
                                    <span style="text-decoration: underline">Valid modifiers are:</span><br>
                                    ex: Explosive<br>
                                    dbk: Double Knockback<br>
                                    dbt: Double Blunt Trauma<br>
                                    nw: No Wounding<br>
                                </div>
                            </span>
                        </span>
                    </td>
                    <td>
                        <span class="tooltip">
                            <input type="text" name="system.melee.{{id}}.armourDivisor" value="{{melee.armourDivisor}}" title="{{melee.armourDivisor}}" style="text-align:left;" />
                            <span class="tooltiptext" style="margin-left: -100px">
                                <div>
                                    Default is 1<br>
                                    0 makes effective armour infinite<br>
                                    Using the words 'ignore' or 'cosmic' allows the attack to ignore armour<br>
                                    Setting this to 'I' will also ignore armour
                                </div>
                            </span>
                        </span>
                    </td>
                    <td><input type="text" name="system.melee.{{id}}.reach" value="{{melee.reach}}" title="{{melee.reach}}" style="text-align:left;" /></td>
                    <td><input type="text" name="system.melee.{{id}}.st" value="{{melee.st}}"/></td>
                    <td><a class="attack-delete" id="meleee{{id}}" title="Delete Item"><i class="fas fa-trash"></i></a></td>
                </tr>
                {{/each}}
                </table>
            </div>
        </div>

        {{!-- Ranged Tab --}}
        <div class="tab stats" data-tab="ranged" data-group="primary">
            <h3 class="addRangedRow" style="text-align: right;">Add Row</h3>
            <div class="tab">
                <table>
                    <tr class="equipment-header">
                        <td class="resource-label">ID</td>
                        <td class="resource-label">Name</td>
                        <td class="resource-label">Level</td>
                        <td class="resource-label">Skill Name / Mod</td>
                        <td class="resource-label">Acc</td>
                        <td class="resource-label">Damage</td>
                        <td class="resource-label">Type</td>
                        <td class="resource-label">Divisor</td>
                        <td class="resource-label">Range</td>
                        <td class="resource-label">Rof</td>
                        <td class="resource-label">Shots</td>
                        <td class="resource-label">Bulk</td>
                        <td class="resource-label">Rcl</td>
                        <td class="resource-label">ST</td>
                        <td class="resource-label">Malf</td>
                        <td class="resource-label"></td>
                    </tr>
                    {{#each item.system.ranged as |ranged id|}}
                    <tr class="equipment-entry">
                        <td class="resource-label">{{id}}</td>
                        <td><input type="text" name="system.ranged.{{id}}.name" value="{{name}}" title="{{name}}" style="text-align:left;" /></td>
                        <td class="resource-label">{{ranged.level}}</td>
                        <td class="equipmentInputInput">
                            <input type="text" name="system.ranged.{{id}}.skill" value="{{ranged.skill}}" title="{{ranged.skill}}" style="text-align:left;" />/
                            <input type="text" name="system.ranged.{{id}}.skillMod" value="{{ranged.skillMod}}" data-dtype="Number"/>
                        </td>
                        <td><input type="text" name="system.ranged.{{id}}.acc" value="{{ranged.acc}}" data-dtype="Number"/></td>
                        <td><input type="text" name="system.ranged.{{id}}.damageInput" value="{{ranged.damageInput}}" title="{{ranged.damageInput}}" style="text-align:left;" /></td>
                        <td>
                            <span class="tooltip">
                                <input type="text" name="system.ranged.{{id}}.damageType" value="{{ranged.damageType}}" title="{{ranged.damageType}}" style="text-align:left;" />
                                <span class="tooltiptext" style="margin-left: -100px">
                                    <div>
                                        <span style="text-decoration: underline">Valid entries are:</span><br>
                                        burn: Burning<br>
                                        cor: Corrosion<br>
                                        cr: Crushing<br>
                                        cut: Cutting<br>
                                        fat: Fatigue<br>
                                        imp: Impaling<br>
                                        pi-: Small Piercing<br>
                                        pi: Piercing<br>
                                        pi+: Large Piercing<br>
                                        pi++: Huge Piercing<br>
                                        tox: Toxic<br>
                                        tbb: Tight Beam Burning<br>
                                        dam: Untyped<br>
                                        <span style="text-decoration: underline">Valid modifiers are:</span><br>
                                        ex: Explosive<br>
                                        dbk: Double Knockback<br>
                                        dbt: Double Blunt Trauma<br>
                                        nw: No Wounding<br>
                                    </div>
                                </span>
                            </span>
                        </td>
                        <td>
                            <span class="tooltip">
                                <input type="text" name="system.ranged.{{id}}.armourDivisor" value="{{ranged.armourDivisor}}" title="{{ranged.armourDivisor}}" style="text-align:left;" />
                                <span class="tooltiptext" style="margin-left: -100px">
                                    <div>
                                        Default is 1<br>
                                        0 makes effective armour infinite<br>
                                        Using the words 'ignore' or 'cosmic' allows the attack to ignore armour<br>
                                        Setting this to 'I' will also ignore armour
                                    </div>
                                </span>
                            </span>
                        </td>
                        <td><input type="text" name="system.ranged.{{id}}.range" value="{{ranged.range}}" title="{{ranged.range}}" style="text-align:left;" /></td>
                        <td><input type="text" name="system.ranged.{{id}}.rof" value="{{ranged.rof}}" title="{{ranged.rof}}" style="text-align:left;" /></td>
                        <td><input type="text" name="system.ranged.{{id}}.shots" value="{{ranged.shots}}" title="{{ranged.shots}}" style="text-align:left;" /></td>
                        <td><input type="text" name="system.ranged.{{id}}.bulk" value="{{ranged.bulk}}" title="{{ranged.bulk}}" style="text-align:left;" /></td>
                        <td><input type="text" name="system.ranged.{{id}}.rcl" value="{{ranged.rcl}}" title="{{ranged.rcl}}" style="text-align:left;" /></td>
                        <td><input type="text" name="system.ranged.{{id}}.st" value="{{ranged.st}}"/></td>
                        <td><input type="text" name="system.ranged.{{id}}.malf" value="{{ranged.malf}}"/></td>
                        <td><a class="ranged-delete" id="ranged{{id}}" title="Delete Item"><i class="fas fa-trash"></i></a></td>
                    </tr>
                    {{/each}}
                </table>
            </div>
        </div>

        {{!-- Affliction Tab --}}
        <div class="tab stats" data-tab="affliction" data-group="primary">
            <h3 class="addAfflictionRow" style="text-align: right;">Add Row</h3>
            <div class="tab">
                <table>
                    <tr class="equipment-header">
                        <td class="resource-label">Name</td>
                        <td class="resource-label">Level</td>
                        <td class="resource-label">Skill Name / Mod</td>
                        <td class="resource-label">Damage</td>
                        <td class="resource-label">Type</td>
                        <td class="resource-label">Divisor</td>
                        <td class="resource-label">Effect Description</td>
                        <td class="resource-label">Range Penalties</td>
                        <td class="resource-label" style="width: 240px">
                            <span class="tooltip">
                                Resist With
                                <span class="tooltiptext" style="margin-left: -100px;">For both Quick Contests and Resistance Rolls.<br>
                                    Penalty applies to the target's roll in either case.</span>
                            </span>
                        </td>
                        <td class="resource-label">
                            <span class="tooltip">
                                Rule Of
                                <span class="tooltiptext" style="margin-left: -100px;">This should be 13 for Fright and 16 for everything else except in special cases.</span>
                            </span>
                        </td>
                        <td class="resource-label"></td>
                    </tr>
                    {{#each item.system.affliction as |affliction id|}}
                    <tr class="equipment-entry">
                        <td><input type="text" name="system.affliction.{{id}}.name" value="{{name}}" title="{{name}}" style="text-align:left;" /></td>
                        <td class="resource-label">{{affliction.level}}</td>
                        <td class="equipmentInputInput">
                            <input type="text" name="system.affliction.{{id}}.skill" value="{{affliction.skill}}" title="{{affliction.skill}}" style="text-align:left;" />/
                            <input type="text" name="system.affliction.{{id}}.skillMod" value="{{affliction.skillMod}}" data-dtype="Number"/>
                        </td>
                        <td><input type="text" name="system.affliction.{{id}}.damageInput" value="{{affliction.damageInput}}" title="{{affliction.damageInput}}" style="text-align:left; width: 40px;" /></td>
                        <td>
                            <span class="tooltip">
                                <input type="text" name="system.affliction.{{id}}.damageType" value="{{affliction.damageType}}" title="{{affliction.damageType}}" style="text-align:left; width: 40px;" />
                                <span class="tooltiptext" style="margin-left: -100px">
                                    <div>
                                        <span style="text-decoration: underline">Valid entries are:</span><br>
                                        burn: Burning<br>
                                        cor: Corrosion<br>
                                        cr: Crushing<br>
                                        cut: Cutting<br>
                                        fat: Fatigue<br>
                                        imp: Impaling<br>
                                        pi-: Small Piercing<br>
                                        pi: Piercing<br>
                                        pi+: Large Piercing<br>
                                        pi++: Huge Piercing<br>
                                        tox: Toxic<br>
                                        tbb: Tight Beam Burning<br>
                                        dam: Untyped<br>
                                        <span style="text-decoration: underline">Valid modifiers are:</span><br>
                                        ex: Explosive<br>
                                        dbk: Double Knockback<br>
                                        dbt: Double Blunt Trauma<br>
                                        nw: No Wounding<br>
                                        la: Large Area Injury<br>
                                        area: Large Area Injury<br>
                                    </div>
                                </span>
                            </span>
                        </td>
                        <td>
                            <span class="tooltip">
                                <input type="text" name="system.affliction.{{id}}.armourDivisor" value="{{affliction.armourDivisor}}" title="{{affliction.armourDivisor}}" style="text-align:left; width: 40px;" />
                                <span class="tooltiptext" style="margin-left: -100px">
                                    <div>
                                        Default is 1<br>
                                        0 makes effective armour infinite<br>
                                        Using the words 'ignore' or 'cosmic' allows the attack to ignore armour<br>
                                        Setting this to 'I' will also ignore armour
                                    </div>
                                </span>
                            </span>
                        </td>
                        <td><input type="text" name="system.affliction.{{id}}.desc" value="{{desc}}" title="{{desc}}" style="text-align:left;" /></td>
                        <td class="resource-label">
                            <select name="system.affliction.{{id}}.rangePenalties">
                                {{#select affliction.rangePenalties}}
                                <option value="">Make a Selection</option>
                                <option value="regular">Regular (-1/yard)</option>
                                <option value="ssrt">Size/Speed/Range Table</option>
                                <option value="long">Long Distance Penalties</option>
                                <option value="none">None</option>
                                {{/select}}
                            </select>
                        </td>
                        <td style="display: flex; width: 240px" >
                            <select name="system.affliction.{{id}}.resistanceType">
                                {{#select affliction.resistanceType}}
                                <option value="">Make a Selection</option>
                                <option value="contest">Quick Contest</option>
                                <option value="resistance">Resistance</option>
                                <option value="irresistible">Irresistible</option>
                                {{/select}}
                            </select>
                            <select name="system.affliction.{{id}}.resistanceRoll" class="resistanceRoll">
                                {{#select affliction.resistanceRoll}}
                                <option value="">None</option>
                                <option value="Strength">ST</option>
                                <option value="Dexterity">DX</option>
                                <option value="Intelligence">IQ</option>
                                <option value="Health">HT</option>
                                <option value="Will">Will</option>
                                <option value="Perception">Per</option>
                                <option value="Fright">Fright</option>
                                {{/select}}
                            </select>
                            <input type="text" placeholder="-0" name="system.affliction.{{id}}.resistanceRollPenalty" value="{{affliction.resistanceRollPenalty}}" title="{{affliction.resistanceRollPenalty}}" style="text-align:left; width: 40px; margin: unset" />
                        </td>
                        <td><input type="text" name="system.affliction.{{id}}.ruleOf" value="{{affliction.ruleOf}}" title="{{affliction.ruleOf}}" style="text-align:left; width: 40px;" /></td>
                        <td><a class="affliction-delete" id="affliction{{id}}" title="Delete Item"><i class="fas fa-trash"></i></a></td>
                    </tr>
                    {{/each}}
                </table>
            </div>
        </div>
    </section>
</form>
